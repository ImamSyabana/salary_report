<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan Gaji Cikarang</title>

    <style>
        body { font-family: sans-serif; }
        /* This <pre> tag will hold our formatted JSON data */
        pre {
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            padding: 15px;
            white-space: pre-wrap; /* This makes the text wrap */
            word-wrap: break-word;
            max-height: 600px; /* Makes it scrollable if too long */
            overflow-y: auto;
        }
    </style>

</head>
<body>
    <h1>Pengecekan laporan Gaji Berhasil!</h1>

    <h2>Data JSON (Hasil Pengecekan):</h2>
    <pre id="json-container">Loading data...</pre>
    
    <hr>
    <a href="/cikarang">Upload file lain</a><br>
    <a href="/">Go Home</a>

    <script>
        // 1. Get the query string from the URL
        const params = new URLSearchParams(window.location.search);
        // This 'file' parameter matches the one from our RedirectResponse
        const filename = params.get('file');

        const container = document.getElementById('json-container');
        
        if (filename) {
            // 2. This is the new API URL we will build in main.py
            const fileUrl = `/get-uploaded-file/${filename}`;
            

            // 3. Fetch the file content
            fetch(fileUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('File not found or error loading.');
                    }
                    return response.json(); // Parse the response as a JSON object
                })
                .then(jsonData => {
                    // 4. We got the data! Now let's "pretty-print" it.
                    // JSON.stringify(obj, null, 2) formats it with 2-space indents
                    const formattedJson = JSON.stringify(jsonData, null, 2);
                    
                    // 5. Display the formatted text in the <pre> tag
                    container.textContent = formattedJson;

                    // --- THIS IS WHERE YOU WOULD VISUALIZE ---
                    // Now you have the 'jsonData' object.
                    // You can pass it to a charting library, e.g.:
                    createMyCharts(jsonData.office, jsonData.driver);
                })
                .catch(error => {
                    container.textContent = `Error: ${error.message}`;
                });
            
        } else {
            container.textContent = 'Error: No data file specified.';
        }
    </script>
</body>
</html>